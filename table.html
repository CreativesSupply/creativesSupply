<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Slots</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            text-align: center;
            padding: 8px;
        }
        th {
            background-color: #f4f4f4;
        }
        .booked {
            background-color: red;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h2>Available Slots</h2>
    <table id="slotsTable">
        <thead id="tableHead">
            <tr>
                <th>Time</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbwXVOV3mNmsEytRQQ1P4TY9JlCAFY2RaMUypcQAqKvoRxg3qMiqi63ZkJRKBQJOvji7KQ/exec"; // Replace with your actual API URL

        // Convert "7March" to YYYY-MM-DD format
        function parseCustomDate(dateString) {
            const months = {
                "January": "01", "February": "02", "March": "03", "April": "04",
                "May": "05", "June": "06", "July": "07", "August": "08",
                "September": "09", "October": "10", "November": "11", "December": "12"
            };

            let match = dateString.match(/^(\d+)([A-Za-z]+)$/);
            if (!match) return null; // Invalid format

            let day = match[1].padStart(2, "0"); // Ensure two-digit day
            let month = months[match[2]];
            let year = new Date().getFullYear(); // Assume current year

            return `${year}-${month}-${day}`;
        }

        // Convert "415AM" to "04:15 AM"
        function parseCustomTime(timeString) {
            let match = timeString.match(/^(\d{1,2})(\d{2})(AM|PM)$/);
            if (!match) return null;

            let hours = parseInt(match[1]);
            let minutes = match[2];
            let period = match[3];

            if (period === "PM" && hours !== 12) hours += 12;
            if (period === "AM" && hours === 12) hours = 0;

            return `${String(hours).padStart(2, "0")}:${minutes}`;
        }

        // Generate dates from today to April 10
        function getDateRange() {
            let today = new Date();
            let endDate = new Date("2025-04-10");
            let dateArray = [];

            while (today <= endDate) {
                let formattedDate = today.toISOString().split("T")[0]; // YYYY-MM-DD format
                dateArray.push(formattedDate);
                today.setDate(today.getDate() + 1);
            }
            return dateArray;
        }

        // Generate time slots (adjust as needed)
        function getTimeSlots() {
            return [
                "04:00 AM", "04:15 AM", "04:30 AM", "04:45 AM",
                "08:00 AM", "09:00 AM", "10:00 AM", "11:00 AM",
                "12:00 PM", "01:00 PM", "02:00 PM", "03:00 PM",
                "04:00 PM", "05:00 PM", "06:00 PM", "07:00 PM"
            ];
        }

        // Fetch bookings from API
        async function fetchBookings() {
            try {
                let response = await fetch(API_URL);
                let result = await response.json();

                if (result.status === "success") {
                    return result.data.map(b => ({
                        date: parseCustomDate(b.date),
                        time: parseCustomTime(b.time)
                    }));
                } else {
                    console.error("Failed to fetch bookings");
                    return [];
                }
            } catch (error) {
                console.error("Error fetching data:", error);
                return [];
            }
        }

        // Build table
        async function buildTable() {
            let dates = getDateRange();
            let timeSlots = getTimeSlots();
            let bookings = await fetchBookings();

            let tableHead = document.getElementById("tableHead");
            let tableBody = document.getElementById("tableBody");

            // Clear previous table data
            tableHead.innerHTML = "<tr><th>Time</th></tr>";
            tableBody.innerHTML = "";

            // Add date headers
            let headerRow = tableHead.querySelector("tr");
            dates.forEach(date => {
                let th = document.createElement("th");
                th.textContent = date;
                headerRow.appendChild(th);
            });

            // Create rows for each time slot
            timeSlots.forEach(time => {
                let row = document.createElement("tr");
                let timeCell = document.createElement("td");
                timeCell.textContent = time;
                row.appendChild(timeCell);

                // Fill each date column
                dates.forEach(date => {
                    let cell = document.createElement("td");
                    let isBooked = bookings.some(b => b.date === date && b.time === time);

                    if (isBooked) {
                        cell.textContent = "Booked";
                        cell.classList.add("booked");
                    } else {
                        cell.textContent = "Available";
                    }

                    row.appendChild(cell);
                });

                tableBody.appendChild(row);
            });
        }

        // Load table on page load
        document.addEventListener("DOMContentLoaded", buildTable);
    </script>
</body>
</html>
